<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

# config

Configuration module.
Exists just to collect most of the app configuration aspects in one place.
Is not supposed be edited at runtime.

# crypto/keys

Peerio Crypto module for key handling.

## deriveKeys

Deterministically derives boot key and auth key pair.

**Parameters**

-   `username`  
-   `passphrase`  
-   `salt`  

## generateSigningKeyPair

Generates new random signing (ed25519) key pair.
32 byte public key and 64 byte secret key.

## generateEncryptionKeyPair

Generates new random asymmetric (curve25519) key pair.

## generateEncryptionKey

Generates new random symmetric (xsalsa20) 32 byte secret key.

## generateAuthSalt

Generates new salt for auth process

## getAuthKeyHash

Hashes auth public key

**Parameters**

-   `key`  

## deriveKeyFromPasscode

**Parameters**

-   `passcode`  {String}

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Uint8Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)>** 

# crypto/public

Public key encryption module

# crypto/secret

Secret key encryption module.
encrypt and decrypt functions replace nacl.secretbox and nacl.secretbox.open.
This replacement reduces the amount of memory allocation and copy operations.
The output cipher bytes have following differences with nacl.secretbox output:

-   nonce is appended to the cipher bytes.
-   16 BOXZEROBYTES in the beginning of cipher bytes are not stripped and another 16 are appended to them

Cipherbytes structure:
[ 32 zero bytes ][ actual cipher bytes ][ 24-byte nonce]

## encrypt

Encrypts and authenticates data using symmetric encryption.
This is a refactored version of nacl.secretbox().

**Parameters**

-   `msgBytes`  
-   `key`  

## encryptString

Helper method to decode string to bytes and encrypt it.

**Parameters**

-   `msg`  
-   `key`  

## decrypt

Decrypts and authenticates data using symmetric encryption.
This is a refactored version of nacl.secretbox.open().

**Parameters**

-   `cipher`  
-   `key`  

## decryptString

Helper method to decode decrypted data to a string.

**Parameters**

-   `cipher`  
-   `key`  

# crypto/sign

Digital signing module

## sign

Signs the message with secret key and returns detached signature

**Parameters**

-   `message`  
-   `secretKey`  

# crypto/util

Peerio Crypto Utilities module.

## getRandomBytes

Universal access to secure PRNG
browser version

**Parameters**

-   `num`  

## concatTypedArrays

Concatenates two Uint8Arrays.
Returns new concatenated array.

**Parameters**

-   `buffer1`  
-   `buffer2`  

## strToBytes

Converts UTF8 string to byte array.
Uses native TextEncoder with Buffer polyfill fallback.

**Parameters**

-   `str`  

## bytesToStr

Converts byte array to UTF8 string .
Uses native TextEncoder with Buffer polyfill fallback.

**Parameters**

-   `bytes`  

## b64ToBytes

Converts Base64 string to byte array.

**Parameters**

-   `str`  

## bytesToB64

Converts byte array to Base64 string.

**Parameters**

-   `bytes`  

## getRandomNonce

Generates 24-byte unique(almost) random nonce.

# engine

Pluggable local storage

# name

Format name from prefix for db key

**Parameters**

-   `n`  string key

# get

Get value for key

**Parameters**

-   `n`  string key

Returns **any** value|null in promise

# set

Set value for key

**Parameters**

-   `n`  string key
-   `v`  JSON-serializable value

Returns **any** promise

# setEngine

Set engine to be used for small db storage

**Parameters**

-   `params`  

# system

Current system db

# user

Current user db

# open

Open/create db

**Parameters**

-   `name`  unique name of the db

Returns **any** LocalDb instance

# openUserDb

Open/create user db and set it as current user db

**Parameters**

-   `name`  Username

Returns **any** LocalDb instance

# normalize

Use this helper to resolve returning error value.
If you:

-   have an error result from catch() or reject()
-   don't know what exactly that result is, Error, string, undefined or something else
-   don't need custom errors just want to generate meaningful Error object
    then call normalize and pass the result you've got together with fallback message
    that will be wrapped in Error object and returned in case the result wasn't instance of Error

**Parameters**

-   `error`  
-   `failoverMessage`  

# errors

Peerio custom error types and error handling helpers

**Parameters**

-   `error`  
-   `failoverMessage`  

# getGenericCustomError

helper function to create custom errors with less code.
It's useful when your custom error only expects to have an optional `message` and `data` object arguments.

**Parameters**

-   `name` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** custom error name, should match the class name you will use for the error

# extensions/buffer

'buffer' module extensions.
Modifies and exports Buffer module.

# slice

Uint8Array extensions and polyfills.

# require

Icebear client lib entry point

# models/phrase-dictionary

Passphrase dictionary module

# constructor

Creates new PhraseDictionary

**Parameters**

-   `dictString`  '\\n' separated word list

# getPassphrase

Returns a random passphrase of chosen word length

**Parameters**

-   `length`  

# dispose

Free RAM by deleting cached dictionary

# models/user

Authentication module for User model.

# models/user

Chats module for User model.

# models/user

# models/user

Registration module for User model.

# getPasscodeSecret

Given a passcode and a populated User model, gets a passcode-encrypted
secret containing the username and passphrase as a JSON string.

**Parameters**

-   `passcode`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** 

# getAuthDataFromPasscode

Utility to get an object containing username, passphrase.

**Parameters**

-   `passcode`  
-   `passcodeSecret`  

# SharedBootKeg

Keg database module

## constructor

**Parameters**

-   `db` **KegDb** owner instance
-   `bootKey` **[Uint8Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)** 

# constructor

Creates new database instance

**Parameters**

-   `id` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 'SELF' for own database, or specific id for shared databases
-   `users`  

# createBootKeg

Create boot keg for this database
todo: when we will have key change, we'll need update operation load()->update() because of keg version

**Parameters**

-   `bootKey` **[Uint8Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)** 
-   `data` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

# loadBootKeg

Retrieves boot keg for the db and initializes this KegDb instance with required data.

**Parameters**

-   `bootKey`  

# models/keg

Base class for kegs

# Keg

Base class with common data and operations.
For clarity:

-   we refer to runtime unencrypted keg data as `data`
-   we(and server) refer to encrypted(or plaintext string) keg data as `payload`

## keyId

## key

## version

## data

## constructor

**Parameters**

-   `type` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** keg type
-   `db` **KegDb** keg database owning this keg
-   `id` **([string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) | null)** kegId, or null for new kegs
-   `plaintext` **([boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean) | null)** should keg be encrypted

## create

Creates keg (reserves id) and writes out payload with this.update()

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Keg](#keg)>** 

## update

Updates existing server keg with new/same data from this.payload
todo: reconcile optimistic concurrency failures

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** 

## load

Populates this keg instance with data from server

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Keg](#keg)>** 

## serializeData

Generic version that provides this.data as it is.
Override in child classes for fine-grained control over serialization.

## deserializeData

Generic version that parses decrypted keg payload string.
Override in child classes for fine-grained control over deserialization.

**Parameters**

-   `payload`  

## detectTampering

Compares keg metadata with encrypted payload to make sure server didn't change metadata.

**Parameters**

-   `payload`  {Object} - decrypted keg payload


-   Throws **any** AntiTamperError

# createAccountAndLogin

Full registration process.
Initial login after registration differs a little.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** 

# login

Authenticates connection and makes necessary initial requests.

# BootKeg

Keg database module

## constructor

**Parameters**

-   `db` **KegDb** owner instance
-   `bootKey` **[Uint8Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)** 

# constructor

Creates new database instance

**Parameters**

-   `id` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 'SELF' for own database, or specific id for shared databases

# createBootKeg

Create boot keg for this database
todo: when we will have key change, we'll need update operation load()->update() because of keg version

**Parameters**

-   `bootKey` **[Uint8Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)** 
-   `data` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

# loadBootKeg

Retrieves boot keg for the db and initializes this KegDb instance with required data.

**Parameters**

-   `bootKey`  

# network/socket-client

Peerio network socket client module.
This module exports SocketClient class that can be instantiated as many times as needed.
Other modules contain singleton instances for general use.

# SocketClient

Create an instance of Socket per connection.

## STATES

Possible connection states

## SOCKET_EVENTS

System events

## APP_EVENTS

Application events

## state

Returns connection state

## subscribe

Subscribes a listener to one of the socket or app events.

**Parameters**

-   `event` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** event name, one of SOCKET_EVENTS or APP_EVENTS
-   `listener` **[function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** event handler

Returns **[function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** function you can call to unsubscribe

## unsubscribe

Unsubscribes a listener to socket or app events

**Parameters**

-   `event`  
-   `listener`  

## send

Send a message to server

**Parameters**

-   `name`  
-   `data`  

## onceConnected

Executes a callback only once when socket will connect, or immediately if socket is connected already

**Parameters**

-   `callback`  

## close

Closes current connection and disables reconnects.

# network/socket

Main SocketClient singleton instance

# stores/user-store

User data store

# util

Various utility functions

**Parameters**

-   `obj`  

# convertBuffers

Wraps all ArrayBuffer type properties in Uint8Array recursively

**Parameters**

-   `obj`  
